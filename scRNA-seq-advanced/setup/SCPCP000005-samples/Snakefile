# Workflow for preprocessing SCPCP000005 data used for integration instruction
# Raw files are expected to be present in the `config[raw_dir]` directory

configfile: "config.yaml"
outdir = "processed"

rule target:
  input:
    expand(os.path.join(outdir, "{library}.rds"),
           library = config["libraries"])



rule prepare_library:
  input: 
    filtered_rds = "raw/{library}_filtered.rds",
    celltype_tsv = config["celltypes_file"]
  output:
    os.path.join(outdir, "{library}.rds")
  log: 
    "logs/{library}_prep.log"
  shell:
    """
      Rscript prepare_integration_libraries.R \
        --input_sce_file "{input.filtered_rds}" \
        --output_sce_file "{output}" \
        --celltypes_file "{input.celltype_tsv}"
         &> {log}
    """

