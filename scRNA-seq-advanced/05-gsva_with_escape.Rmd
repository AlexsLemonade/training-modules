---
title: "R Notebook"
output: html_notebook
---

```{r}
suppressPackageStartupMessages({
  library(SingleCellExperiment)
})

# Gene set/pathway analysis
library(escape)
library(msigdbr)
```

```{r}
hallmarks_df <- msigdbr(species = "Homo sapiens",
                        category = "H") 
hallmark_gene_sets <- unique(hallmarks_df$gs_name)

hallmarks_list <- hallmark_gene_sets |>
  purrr::map(
    \(gene_set_name) hallmarks_df |>
      dplyr::filter(gs_name == gene_set_name) |>
      dplyr::pull(ensembl_gene)
  ) |>
  purrr::set_names(hallmark_gene_sets)

# Remove data frame version
# rm(hallmarks_df)
```

```{r}
sce <- readr::read_rds("data/ewing-sarcoma/processed/SCPCS000490/SCPCL000822_processed.rds")
```



```{r}
sce_escape <- runEscape(sce, 
                        method = "GSvA",
                        gene.sets = hallmarks_list, 
                        groups = 1000, 
                        min.size = 5,
                        new.assay.name = "escape_GSVA")
```

